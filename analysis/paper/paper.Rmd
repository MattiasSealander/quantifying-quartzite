---
title: "Title Goes Here"
author:
  - Myfirstname Mylastname:
      email: fl@oneplace.edu
      institute: [UofO]
      correspondence: true
  - Yourfirstname Yourlastname:
      email: fl@another.edu
      institute: [UofA]
      correspondence: false
institute:
  - UofO: University of One Place
  - UofA: University of Another Place
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" # Insert path for the DOCX file
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

<!-- The actual document text starts here: -->

# Introduction

Here is a citation [@Marwick2017]

# Background

# Methods

# Results

<!-- Here's some example analysis code: -->
```{r load-packages}
library(tidyverse)
library(rrtools)
library(here)
library(infer)
library(prospectr)
library(FactoMineR)
library(factoextra)

#Read in raw NIR measurements with meatadata
NIR <- as.data.frame(read.csv2(here("analysis/data/raw_data//NIR_raw_data.csv"), sep = ";", dec = ".", header = TRUE, encoding = "UTF-8"))

#Prepare filtering
artefact <- c("Point", "Point fragment", "Preform")
material <- c("Quartzite", "Breccie quartz", "Breccie quartzite", "Felsitic porphyric quartz", "Quartz")

#Filter data to focus on quartzite points, point fragments and preforms
Points <-
  NIR %>%
    filter(material %in% material,
           type %in% artefact)
```


```{r vis-nir-scree, fig.cap="Contributing variables to PC1"}
#Select data for visible range of spectrum
vis_nir <-
  Points %>%
    select(unique_id, X400.0:X700.0)

#mean center measurements
vis_nir_center <-
  vis_nir %>%
    mutate(across(c(2:302), scale, scale = FALSE))

#centered  PCA
VNIR.pca <- FactoMineR::PCA(vis_nir_center[,c(2:302)], graph = FALSE, scale.unit = FALSE)

#Screeplot of contributing variables to PC1
#dashed reference line corresponds to the expected value if the contribution was uniform.
fviz_contrib(VNIR.pca,
             choice = "var",
             fill = "black",
             color = "black",
             axes = 1,
             top = 60,
             title = "Contribution of variables to PC1") +
        theme_minimal(base_size = 20) +
        theme(axis.title.x=element_blank(), text = element_text(size=10),
                axis.text.x = element_text(angle=45, hjust=1))
```

Figure \@ref(fig:vis-nir-scree) shows that higher absorbance in the red part of the spectrum contributes more to PC1.

```{r vis-nir-pca, fig.cap="PCA of NIR measurements in the 400 - 700 nm part of the spectrum"}
#PCA of centered data
fviz_pca_ind(VNIR.pca, axes = c(1, 2),
                geom = c("point"),
                geom.ind = c("point"), # show points only (but not "text")
                label = "var",
                palette = c("#BC3C29FF", "#0072B5FF", "#EE4C97FF", "#E18727FF"),
                col.ind = Points$hue, #color by sample hue
                fill.ind = Points$hue, #fill point by sample hue
                addEllipses = FALSE,
                repel = TRUE,
                obs.scale = 1, var.scale = 1,
                legend.title = "Hue",
                title = "PCA - Quartzite points") +
      theme_minimal(base_size = 20) +
      scale_shape_manual(values=c(21,22,23,24)) +
      labs(x = "PC1 (98%)",
           y = "PC2 (1.9%)")
```



```{r demo-inline-code}
x <- round(pi, 2)
```

Here is an example of inline code `r x` in the middle of a sentence. 

# Discussion

# Conclusion

# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References 

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

<div id="refs"></div>

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
