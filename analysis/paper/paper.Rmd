---
title: "Semi-quantitative petrographic characterization of Bronze Age quartzite tools – a multivariate approach"
author:
  - Mattias Sjölander:
      email: mattias.sjolander@umu.se
      institute: [UmU]
      correspondence: true
institute:
  - UmU: Umeå University
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    bookdown::word_document2:
      fig_caption: yes
      reference_docx: "../templates/template.docx" 
      pandoc_args:
      - --lua-filter=../templates/scholarly-metadata.lua
      - --lua-filter=../templates/author-info-blocks.lua
      - --lua-filter=../templates/pagebreak.lua
mainfont: Times New Roman
bibliography: references.bib
csl: "../templates/journal-of-archaeological-and-anthropological-science.csl"
abstract: |
  Text of abstract
keywords: |
  Spectroscopy; Quartzite; Characterization; Lithics
highlights: |
  These are the highlights. 
---

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The following code chunk defines some general settings how code chunks should behave. -->

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 300
)
```

<!-- The following code chunk defines prepares most of the data that will be needed and reads in the necessary libraries -->

```{r load-packages-and-data}
library(ChemoSpec)
library(data.table)
library(factoextra)
library(ggbiplot)
library(ggplot2)
library(ggsci)
library(grid)
library(gridBase)
library(gridExtra)
library(missMDA)
library(patchwork)
library(prospectr)
library(tidyverse)
library(spectrolab)

#Import xrf data, set empty fields to NA
XRF.csv <-
  read.csv2("./analysis/data/raw_data/XRF/XRF_quantitative.csv", sep = ";", dec = ".", header = TRUE, check.names = FALSE, na = c("","NA","NULL"))

#Import nir data, set empty fields to NA
nir.csv <-
  read.csv2("./analysis/data/derived_data/NIR_master_averaged_20210914.csv", sep = ";",
            dec = ",", header = TRUE, check.names = FALSE, na = c("","NA","NULL",NULL))

#Import raman data, set empty fields to NA
raman.csv <-
  read.csv2("./analysis/data/derived_data/raman_baseline_corrected_20210826.csv", sep = ";", dec = ",", header = TRUE, check.names = FALSE, na = c("","NA","NULL",NULL))

#Import sample list, set empty fields to NA
samples <-
  read.csv2("./analysis/data/raw_data/bifacial_points.csv", sep = ";", dec = ".", header = TRUE, check.names = FALSE, na.strings=c("", "NA"))

#Filter xrf, nir and raman data to focus on points and preforms made from quartz/quartzite material 
Points.xrf <-
  XRF.csv %>%
    filter(material == "Quartz" | material == "Quartzite" | material == "Brecciated quartz" | material == "Brecciated quartzite" | material  == "Felsitic porphyric quartz",
         type == "Point" | type == "Point fragment" | type == "Preform")

Points.nir <-
  nir.csv %>%
    filter(material == "Quartz" | material == "Quartzite" | material == "Brecciated quartz" | material == "Brecciated quartzite" | material  == "Felsitic porphyric quartz",
         type == "Point" | type == "Point fragment" | type == "Preform")

Points.raman <-
  raman.csv %>%
    filter(material == "Quartz" | material == "Quartzite" | material == "Brecciated quartz" | material == "Brecciated quartzite" | material  == "Felsitic porphyric quartz", type == "Point" | type == "Point fragment" | type == "Preform")

#Fill the NA fields in the munsell_hue column and mark them as colourless samples
Points.nir[8][is.na(Points.nir[8])] <- "Colourless"
Points.raman[8][is.na(Points.raman[8])] <- "Colourless"
Points.xrf[20][is.na(Points.xrf[20])] <- "Colourless"

#prepare color/fill and symbols for score plots
pca.colors <- c("#E31CFF", "#718EFF", "#0080FF", "#D5DF9E", "#C6DF39", "#FFFFC1", "#FFFFA1", "#FFFF00", "#FFFF38", "#FFB468", "#000000", "#202020", "#404040", "#606060", "#808080", "#9F9F9F", "#DFDFDF", "#FFFFFF")
pca.shapes <- c(24,25,23,22,21)
pca.munsell_hue <- c("Colourless", "2.5PB", "10B", "2.5GY", "5GY", "2.5Y", "5Y", "7.5Y", "10Y", "5YR", "N1", "N2", "N3", "N4", "N5", "N6", "N8", "N9")

```

# Introduction

In regions where local flint and obsidian sources are non-existent, such as Northern Fennoscandia, other materials have been the primary target for lithic production^[This is not to say that flint was not available or used in these regions] [@baudou78; @rankama_etal06; @olausson_etal12]. The last decades have seen an increase in interest for non-flint lithics and raw material studies in  European archaeology, providing much needed development in a previously neglected field [@blomme_etal12; @dalpra_pitblado16; @prieto_etal19; @prieto_etal20; @prieto_etal21; @ramacciotti_etal19]. With the lack of any natural geological source of flint in Northern Sweden both quartz and quartzite are instrumental for the inference of settlement and mobility within the region. While quartz and quartzite technology have been part of a number of studies over the years, there have been less development in the petrographic characterization and provenience studies of these same materials [@broadbent79; @callahan_etal92; @knutsson_etal16; @tallavaara_etal10]. One reason for the lack of methodological development in North Swedish research could be the complex geological background of the region and the abundance of moraine formations [@bargel03; @stephens_bergmanweihed20; @stroeven_etal16]. The degree to which geological materials have been mixed and transported demands considerable effort in order to reconstruct the events that have formed the modern day landscape. While tentaive interpretations of lithic material sourcing tends to describe strategies leaning towards direct procurement from the mountain zone [@forsberg85; -@forsberg12], both quartz and quartzite could potentially have been sourced locally from exposed veins in the bedrock, or as loose rocks and pebbles in the numerous moraine formations, as part of a strategy leaning more towards an embedded adaptation [@binford79; @rankama_etal06 pp.249-250]. Due to this ambiguous nature of availability of raw materials provenience studies are complex and fraught with uncertainty. 

Attempting to define what constitutes a *quartzite* is not so stratightforward. Prieto et al. [-@prieto_etal19 p.15; -@prieto_etal20 p.32] notes that the usage of the term *quartzite* in archaeology has been somewhat ambiguous, often used interchangeably between sedimentary orthoquartzite and metamorphic quartzite. The defintion of quartzite has been a topic of discussion in geology as well [@howard05], and it hence varies somewhat between authors. Visual characterization on a megascopic level is typically unreliable, and microscopic analysis is recommended for the identification of metamorphic structures, but Howard also emphasises the need for field-based methodologies. There are also situations where destructive techniques simply are not applicable. Artefact collections (museum, private, etc.) represent a valuable resource, as well as one of the easier ways of gaining access to large datasets with some geographical distribution. While destructive methods may prohibit access to such material there are still non-destructive methods that can generate valuable information. Aside from being non-destructive spectroscopic instrumentation feature fast measurements, making it an attractive alternative for field-based screening purposes. While X-Ray Fluorescence (XRF) is the go-to spectroscopic technique for petrographic characterization [@shackley11; @tykot03], due to its capability of providing compositional data, there are other instrumentations that may provide a deeper insight into the structural properties. The use of near-infrared spectroscopy (NIRS) goes almost as far back as the XRF [@hunt77], and there is an impressive body of work dedicated to the fingerprinting of geological materials [@linderholm_geladi14a; @linderholm_geladi14b; @sciuto19]. The same can be said for Raman spectroscopy, which has been applied extensively in the Cultural Heritage sector and in the analysis of artwork and manuscripts [@vandenabeele12].   

In the current study a dataset of quartzite artefacts from museum collections in Västerbotten, Sweden, have been analysed using the three above mentioned spectroscopic instrumentations (NIRS, Raman, XRF). The goal is to evaluate their capabilities for fingerprinting quartz and quartzite in the North Swedish region. This will be achieved via Principal Component Analysis (PCA), where the observed groupings of the material in the model will be related to the spectral features for each instrumentation. 
 \linebreak

# Material
```{r select-point-data}
#Filter data to focus on points, point fragments and preforms made from quartz/quartzite materials
Points2 <-
  samples %>%
    filter(material == "Quartz" | material == "Quartzite" | material == "Brecciated quartz" | material == "Brecciated quartzite" | material  == "Felsitic porphyric quartz",
         type == "Point" | type == "Point fragment" | type == "Preform")

#Reorder factor levels
Points2$type <-
  factor(Points2$type, levels=c("Preform", "Point fragment", "Point"))
```

```{r sample-count, results='hide'}
#Filter the sample data to exclude reference samples
tot_samples <- 
  samples %>% 
    filter(type != "Reference") 

#Filter sample data to focus on site Lycksele 301
lycksele <-
  samples %>% 
    filter(site_id == "Lycksele 301") 

#Then filter to focus on quartz/quartzite material that are points and preforms 
lycksele_301 <-
  lycksele %>% 
    filter(material == "Quartz" | material == "Quartzite" | material == "Brecciated quartz" | material == "Brecciated quartzite" | 
             material  == "Felsitic porphyric quartz", type == "Point" | type == "Point fragment" | type == "Preform")

#Create vector of unique samples from site Lycksele 301
lycksele_301 <-
unique(lycksele_301$sample_id)

#Create a vector containing all unique sample ID, in order to count number of total samples (incl. types other than points/preforms or materials) 
tot_uniq <- 
  unique(tot_samples$sample_id)

#Create a vector in order count number of unique rows in sample ID column for the number of points/preforms included in analysis
sample_uniq <- 
  unique(Points2$sample_id)
```

 \linebreak
 \linebreak

The current study is based on spectroscopic surface measurements on quartz and quartzite points recovered from sites within the County of Västerbotten, Sweden. A dataset of `r length(sample_uniq)` points, point fragments and preforms made from quartz/quartzite material stored at the collections at Västerbotten (www.vbm.se) and Skellefteå (www.skellefteamuseum.se) museums were analysed using NIRS, raman and XRF spectroscopy (Appendix XX). The material features a mainly black (N1-N3), grey or white (N9) hue, as well as a subset of semi-translucent material with a beige tint to almost fully translucent. The colour of the material has been classified both according to the munsell system, as well as sorted into general categories of hue (*dark* ~ N1-N4, *light* ~ N5-N8, *white* ~ N9, *Colourless* ~ lack of colour, opaque to translucent) for visualization purposes. A number of these points have, according to prior classifications, been worked using bifacial technology. While there currently is no local chronology available for this artefact type in the North Swedish region, previous research suggest they were in use during the 4 000 – 2 000 BP period [@forsberg85; @forsberg89; @mjaerum12]. Similarly, early studies of raw material use at sites dating to this period seems to indicate an increase in the use of quartzite compared to previous periods [@baudou78]. 

A large portion of the collections stored at North Swedish museums were recovered from excavations and surveys performed in conjunction with the river regulations during the 1940s – 1980s [@biornstad06; @janson_hvarfner60], as well as subsequent follow-up survey projects [e.g. @andersson15]. This has likely had a contributing factor to the distribution pattern of the artefacts observed in fig. \@ref(fig:distribution-map) as the known sites with finds of points and preforms are concentrated around the parishes of Dorotea, Lycksele^[In this case the majority of the samples from Lycksele are from the rock painting site of Lycksele 301], Vilhelmina and Tärnaby. This can be seen more clearly in fig. \@ref(fig:distribution-by-parish) with the four parishes accounting for almost ¾ of the total no. of samples. 

Västerbotten museum have come far in their digitization effort, making large portions of their collections searchable online. Based on a query of all points labelled as *quartz*, *brecciated quartz* or *quartzite* a list was generated from their database. Sampling of this pool of artefacts was not random, and based on geographical distribution, in an effort to include as many artefacts as possible from areas with few finds available, such as along the Vindel river. None of these were from the northernmost Skellefte river, however, and thus a selection of 5 artefacts each from three well-known sites stored at the collections of Skellefte museum were included. This resulted in a total dataset of `r length(tot_uniq)` artefacts, and after documentation and looking up missing information, `r length(sample_uniq)` of these were determined to be either points or preforms made from quartz/quartzite material.

 \linebreak

```{r distribution-map, fig.width=15, fig.height=15, fig.fullwidth=TRUE, fig.cap="White) Sites with measured samples in the County of Västerbotten; Black) Parish centroid for measured samples lacking site coordinates. The distribution of sampled sites is likely affected by the excavation and survey history of the region. Made with Lantmäteriet (CC0), Natural Earth, and Riksantikvarieämbetet."}
knitr::include_graphics('../figures/Distribution.jpeg', error = FALSE)
```

 \linebreak

```{r distribution-by-parish, fig.width=12, fig.height=10, fig.fullwidth=TRUE, fig.cap= paste("Distribution of the", length(sample_uniq), "points and preforms across the parishes in Västerbotten, Sweden. Note that while Lycksele feature a large number of samples", length(lycksele_301), "of these are from the site of Lycksele 301")}

#Stacked bar chart with counts of samples per parish and type
ggplot(Points2, aes(x= fct_rev(parish), fill = type)) +
  geom_bar() +
  theme_minimal() +
  labs(y = "Count",
       fill = "Type") +
  theme(
    legend.position = "bottom",
    legend.title = element_text(size = 16, face = "bold"),
    legend.text = element_text(face = "bold"),
    axis.title.y=element_blank(),
    axis.text.y = element_text(size = 10, face = "bold", colour = "black"),
    axis.title.x = element_text(size = 12, face = "bold", colour = "black")) +
  scale_fill_jco() +
  coord_flip() +
  geom_text(stat ='count', aes(group = parish, label = ..count..), hjust = -0.5)
```

While parts of the collections at Västerbotten museum have been petrographically analysed by a geologist [@biornstad68; @ahman67], at this point it is difficult to say with any certainty how many (if any) of the artefacts in the current dataset were among these. It is fair to assume that the vast majority have been classified visually based on megascopic features according to a “standard” archaeological nomenclature. In the dataset the four main types of registered materials are: quartz, quartzite, brecciated quartz and brecciated quartzite^[Original Swedish terms are *brecciekvarts*/*brecciekvartsit*]. Those that had no prior material classification registered were sorted into either the quartz or quartzite category. The reason for including *quartz* in the study is in order to test whether it is possible to separate quartz from quartzite using these methods, as well as a way to account for potential mistakes in the original classification.

Another reason for keeping a *quartz* category is the group referred to as *brecciated quartz*. In a petrographic study of the artefacts recovered along the Ume river valley Åhman (1967:8) briefly touches upon the definition of *brecciated quartz*, also referring to it as a *mylonite quartz*. Åhman describes the material as having formed from a quartz vein which has fractured due to movements in the mountain massives and recrystallized via pressure. While the translucent material may give the impression of an unusually pure quartzite, Åhman states that the thin-section analysis reveals the fragmented configuration of quartz. *Brecciated quartz* is a somewhat common term used in North Swedish archaeology, and has typically been used to identify a certain translucent type of fine-grained, quartz-rich material [e.g. @holm91].  

 \linebreak

# Methods

 \linebreak
 \linebreak
All measurements were performed at the Environmental Archaeology Lab at Umeå University. The analysis was conducted in a dark room in order to minimize light pollution, with the main light sources in the room being the computer screens. Each artefact was measured twice on different sides, with additional measurements in cases where sampling was difficult. The only exception to this was the XRF, where due to time constraints one measurement was collected as a rule apart from a few exceptions. This lowers the statistical reliability of the XRF analysis and inferences of the results should be evaluated with this in mind. The size of the dataset alleviates some of these issues, as for the larger sites there are multiple objects that may be of the same material, however, for the smaller sites there still remains some uncertainties. For materials that featured high heterogeneity the sample point was focused, as much as possible, on the surrounding matrix.   

Pre-processing of the spectra is different for each instrumentation and based on relevant literature. After pre-processing the data was modelled using PCA, which is an unsupervised exploratory technique for reducing the dimensionality of the dataset [@geladi_linderholm20]. PCA modelling was performed using the base R *prcomp* function [@Rteam17; @rcoreteam21].   

 \linebreak

## Near Infrared
NIRS measures the absorbance of light within the near infrared region (780 nm – 2 500 nm) of the electromagnetic spectrum. Based on the theory of molecular vibration and excitation [@hunt77], by exposing a geological material to electromagnetic radiation it is possible to generate overtone vibrations which can be related to certain molecular groups. The most common group capable of generating these overtones is the OH group, which in quartz-based materials typically relates to molecular water [@hunt77 p.508]. 

NIR analysis was conducted with the Analytical Spectral Device (ASD) LabSpec 4, using a contact probe. The ASD features a detection range of 350 nm – 2500 nm, with spectral sampling (resp. spectral resolution) of 1.4 nm (resp. 3 nm) in the visible and near infrared range and 1.1 nm (resp. 10 nm) in the short‐wave infrared range. Each object was measured against a white reference background and the collected measurements were averaged for each artefact. Two parts of the As there were no notable features in the visible range the analysis was restricted to the 1 000 nm – 2 500 nm region in order to lessen the impact of noise. The data was mean-centred before PCA modelling. 

 \linebreak

## Raman
Raman spectroscopy shares some similarities with NIRS in that they both can be used to infer molecular structure based on their vibrational properties [@nafie01]. However, where NIRS generate overtones of molecular vibration, Raman spectroscopy is based on the *Raman scattering* effect. By exposing a molecule to radiation with a monochromatic laser it is possible to induce a dipole moment in the molecule which generates the Raman effect. The subsequent light that is scattered contains both Rayleigh scatter and Raman scatter, the former at a frequency of incident radiation and the latter at a shifted frequency [@dubessy12]. The spectrometer will measure the Raman scatter and generate a spectrum where the spectral line has shifted compared to the incident Rayleigh frequency. As the structure of a molecule will inform its vibrational mode, the point at which these shifts occur within the infrared region varies depending on the material [@smith_carabatos-nedelec01]. 

The Raman instrumentation used was a portable i-Raman EX featuring a 1064 nm excitation laser. The spectral coverage of the instrumentation is 175 cm^-1^ – 2 500 cm^-1^ ^[Raman shifts are typically given in wavenumber (cm^-1^), instead of spectral wavelength (nm)] with a resolution of 9.5 cm^-1^. Access to the spectrometer was made possible by the department of Forest Biomaterials and Technology at the Swedish University of Agricultural Sciences (SLU) in Umeå. 

After averaging the spectra for each artefact the results were baseline corrected in order to detrend the data. This was achieved using modified polynomial fitting in R [@Rteam17] with the ChemoSpec package [@hanson16]. The spectra were then mean-centred and normalized using Standard Normal Variate [@shaver01 pp.284-285] before PCA. 

 \linebreak

## X-Ray Fluourescence
XRF measurements were collected using a Thermo Scientific Niton XL5 Analyzer, connected to a portable test stand. The reference calibration used for element quantification was set to *mining* mode. Sampling with this setting takes 2 minutes in order for the instrument to cycle through all of the filters (main, low, high, light). Due to time constraints and the number of objects in the current dataset it was only possible to collect one measurement on each object, apart from some exceptions. The XRF data was log-transformed, mean-centered and scaled to unit variance before PCA modelling. As the resulting dataset also features values below the Limit of Detection (LOD), these were treated as NULL, or missing values, during PCA. Since missing values are not permitted during PCA these had to imputed before the analysis, which was performed using the *missMDA* R package [@josse_husson16] developed for datasets with incomplete data. Two methods for imputation can be implemented, iterative or regularized, and since the former suffers when there is a large number of missing values the latter was used. 

 \linebreak

# Results

 \linebreak
 \linebreak

## NIR - visual range

The main explanatory power for the visual region can be found in the first component with an explained variance of 98.4 %. In the PCA (fig. \@ref(fig:vis-nir-pca)) there is a clear trend along PC1 with darker materials being grouped together to the right of the plot and light/colourless/white material to the left. Examining the average spectra of these groups, as expected, the darker material feature higher absorbance of light than the other groups. No other distinctive features can be seen in the visual band, that could potentially be used to distinguish the groups. It is, however, apparent that while the more extreme hues of *dark* and *white* material can be isolated more clearly based on their spectra, there also exists a wider greyscale of material that does not conform as easily to these broader groups. There are also a number of artefacts with a dark hue that gravitate closer to the lighter material in the PCA. While the small size of these artefacts could be an explanation for the placement of these within the model, there are plenty of similarly sized artefacts that do not follow the same trend. 

There are also instances where the measurements on different sides of an artefact end up in different groups in the PCA. In examination of the non-averaged data artefact 403 and 502 both have a sample taken on one side in the *dark* group and the other in the *greyish* middle. This is most likely due to the heterogeneous character of the material and natural variations on the surface possibly related to weathering. The *greyish* middle group in the PCA is otherwise largely made up of opaque material with a beige/grey tint. 

 \linebreak

```{r vis-nir-pca, fig.width=20, fig.height=12, fig.cap="PCA score plot of PC1 and PC2 for the 400 nm – 750 nm band of the spectrum. Quartz-based material with a darker surface group to the right in the model, while those with white surface group in the bottom left quadrant. The strong trend along PC1 also makes it difficult to separate out the muddled grayscale in the middle."}

#perform PCA with SNV normalization and mean-center
visnir.pca <-
  prcomp(Points.nir[,c(78:428)], center = TRUE, scale = FALSE)

#prepare a basic score plot with fviz_pca_ind using PC1 and PC2
basic_plot1 <-
  fviz_pca_ind(visnir.pca, axes = c(1,2), label="none")
basic_plot2 <-
  fviz_pca_ind(visnir.pca, axes = c(1,3), label="none")

#prepare labels for PCs
vis.pc1var <- round(summary(visnir.pca)$importance[2,1]*100, digits=1)
vis.pc2var <- round(summary(visnir.pca)$importance[2,2]*100, digits=1)
vis.pc3var <- round(summary(visnir.pca)$importance[2,3]*100, digits=1)
vis.pc1lab <- paste0("PC1 (",as.character(vis.pc1var),"%)")
vis.pc2lab <- paste0("PC2 (",as.character(vis.pc2var),"%)")
vis.pc3lab <- paste0("PC3 (",as.character(vis.pc3var),"%)")

#VISNIR LOADING LINES
#par(mfrow=c(3,1))
#sapply(1:3, function(comp){
#  plot(400:750, visnir.pca$rotation[,comp], type='l', lwd=2,
#      main=paste("PC", comp), xlab="Wavelength (nm)", ylab="", cex.lab = 1.2, xaxp=c(400,750,6))}) 

#bind the basic fviz plot for PC 1 and 2, and use as basis for a more customizeable plot in ggpplot
visnir.p1 <-
  ggplot(cbind(basic_plot1$data, Points.nir[, c(8,10)]),
             aes(x=x, y=y, 
                 shape = material, 
                 fill = munsell_hue)) +
  geom_point(size=3) +
  theme_bw() +
  ggtitle("Near infrared 400 - 750 nm") +
  labs(x = vis.pc1lab,
       y = vis.pc2lab) +
  scale_shape_manual(name = "Material",
                     values=pca.shapes) +
  scale_fill_manual(name = "Munsell hue",
                    breaks = c("Colourless", "2.5PB", "10B", "2.5GY", "5GY", "2.5Y", "5Y", "7.5Y", "10Y", "5YR", "N1", "N2", "N3", "N4", "N5", "N6", "N8", "N9"),
                    values=pca.colors) +
  guides(shape = guide_legend(override.aes = list(fill = "black"), 
                              ncol=2, 
                              title.position="top", 
                              title.hjust = 0.5),
         fill = guide_legend(override.aes = list(shape = 22,
                                                 fill = pca.colors,
                                                 color = "black",
                                                 size=3),
                             title.position="top", 
                             title.hjust = 0.5)) +
  theme(legend.position = "none")

visnir.p2 <-
  ggplot(cbind(basic_plot2$data, Points.nir[, c(8,10)]),
             aes(x=x, y=y, 
                 shape = material, 
                 fill = munsell_hue)) +
  geom_point(size=3) +
  theme_bw() +
  ggtitle("Near infrared 400 - 750 nm") +
  labs(x = vis.pc1lab,
       y = vis.pc3lab) +
  scale_shape_manual(name = "Material",
                     values=pca.shapes) +
  scale_fill_manual(name = "Munsell hue",
                    breaks = c("Colourless", "2.5PB", "10B", "2.5GY", "5GY", "2.5Y", "5Y", "7.5Y", "10Y", "5YR", "N1", "N2", "N3", "N4", "N5", "N6", "N8", "N9"),
                    values=pca.colors) +
  guides(shape = guide_legend(override.aes = list(fill = "black"), 
                              ncol=2, 
                              title.position="top", 
                              title.hjust = 0.5),
         fill = guide_legend(override.aes = list(shape = 22,
                                                 fill = pca.colors,
                                                 color = "black",
                                                 size=3),
                             title.position="top", 
                             title.hjust = 0.5)) +
  theme(legend.position = "none")

comb1 <-
  visnir.p1 + visnir.p2 & theme(plot.title = element_text(size = 12, face = "bold", colour = "black", vjust = - 10, hjust = 0.02),
                              axis.title.x = element_text(size = 12, face = "bold", colour = "black"),
                              axis.title.y = element_text(size = 12, face = "bold", colour = "black"),
                              legend.title = element_text(size = 12, face = "bold", colour = "black"),
                              legend.background = element_rect(linetype = "solid", color = "black"),
                              legend.position = "bottom")

comb1 +
  plot_layout(nrow = 2, guides = "collect")
```

 \linebreak

```{r vis-nir-spectra, fig.width=20, fig.height=15, fig.cap="Average NIR spectra by hue. Darker samples feature higher overall absorbance with white material absorbing the least amount of light."}

#Filter NIR data to focus on the material with a dark hue 
#and select the NIR range 1 000 - 2 500 nm
vis.dark <- Points.nir %>% 
  filter(hue == "Dark") %>% 
  select(c(1:28),c(79:429))

spec.vd <- 
      as_spectra(vis.dark, name_idx = 1, meta_idxs = 2:28)

vis.light <- Points.nir %>% 
  filter(hue == "Light") %>% 
  select(c(1:28),c(79:429))

spec.vl <- 
  as_spectra(vis.light, name_idx = 1, meta_idxs = 2:28)

vis.colourless <- Points.nir %>% 
  filter(hue == "Colourless") %>% 
  select(c(1:28),c(79:429))

spec.vt <- 
  as_spectra(vis.colourless, name_idx = 1, meta_idxs = 2:28)


vis.white <- Points.nir %>% 
  filter(hue == "White") %>% 
  select(c(1:28),c(79:429))

spec.vw <- 
  as_spectra(vis.white, name_idx = 1, meta_idxs = 2:28)


par(mfrow=c(4,1))

plot(mean(spec.vd), lwd = 1.2, col = "black", ylab = "Absorbance", cex.lab = 1.5, cex.main = 1.5, xlab = "Wavelength (nm)", main = "Average - Dark"); vps1 <- do.call(vpStack, baseViewports())

plot(mean(spec.vl), lwd = 1.2, col = "red", ylab = "Absorbance", cex.lab = 1.5, cex.main = 1.5, xlab = "Wavelength (nm)", main = "Average - Light")

plot(mean(spec.vt), lwd = 1.2, col = "purple", ylab = "Absorbance", cex.lab = 1.5, cex.main = 1.5, xlab = "Wavelength (nm)", main = "Average - Colourless")

plot(mean(spec.vw), lwd = 1.2, col = "blue", ylab = "Absorbance", cex.lab = 1.5, cex.main = 1.5, xlab = "Wavelength (nm)", main = "Average - White"); vps4 <- do.call(vpStack, baseViewports())
```


 \linebreak

## NIR - near infrared range
In the case of NIRS similar features can be observed in the average spectra for all four colour groups, with darker materials exhibiting higher absorbance and the light group the most distinct peaks. The presence of molecular water can be seen in the peaks at 1 400 nm and 1 900 nm  [@hunt77; @sciuto_etal19] (fig. \@ref(fig:nir-spectra)). Peaks also occur at 2 200 nm and 2 350 nm, where the former has been related to combination vibrations of Al-OH and the latter falls within one of the stronger CO^3^ bands [@clark_etal90]. Inspection of individual spectra for the *light* group, however, also reveals a 5th peak for some samples at 2 450 nm. Comparisons to spectra collected on muscovite ([@clark_etal90] p.12 675) shows similar peaks located at 2 200 nm, 2 350 nm, and 2 450 nm. It is therefore possible that the 2 350 nm band in some cases corresponds to CO^3^ vibrations and in other samples Al-OH. 

The PCA shows a strong trend along PC 1 that seems to correlate with the colour of the material(fig. \@ref(fig:nir-pca)). Darker quartzite cluster to the right with white and colourless samples grouping to the opposite side. While the white samples seem to gravitate to the bottom left of the model the samples that are somewhat translucent, such as the *brecciated quartz*, seem to cluster towards the top-left. A small set of 3 black samples at the top of the model separate themselves clearly from the rest of the data points. These three samples come from different sites and exhibit no peaks in their spectra, making them an interesting set of outliers. 

 \linebreak

```{r nir-spectra, fig.width=20, fig.height=15, fig.cap="Average NIR spectra by hue. Darker samples feature higher overall absorbance, as well as less pronounced peaks, when compared to lighter/colourless samples."}

#Filter NIR data to focus on the material with a dark hue 
#and select the NIR range 1 000 - 2 500 nm
dark <- Points.nir %>% 
  filter(hue == "Dark") %>% 
  select(c(1:28),c(680:2179))

#create a spectra object for the dark material, and then repeat for light, white and colourless groups
spec.d <- 
  as_spectra(dark, name_idx = 1, meta_idxs = 2:28)

light <- Points.nir %>% 
  filter(hue == "Light") %>% 
  select(c(1:28),c(680:2179))

spec.l <- 
  as_spectra(light, name_idx = 1, meta_idxs = 2:28)

colourless <- Points.nir %>% 
  filter(hue == "Colourless") %>% 
  select(c(1:28),c(680:2179))

spec.t <- 
  as_spectra(colourless, name_idx = 1, meta_idxs = 2:28)

white <- Points.nir %>% 
  filter(hue == "White") %>% 
  select(c(1:28),c(680:2179))

spec.w <- 
  as_spectra(white, name_idx = 1, meta_idxs = 2:28)

#Prepare a layout with 1 column and four rows
par(mfrow=c(4,1))

#plot the mean spectra for each group
plot(mean(spec.d), lwd = 1.2, col = "black", ylab = "Absorbance", cex.lab = 1.5, cex.main = 1.5, xaxp=c(1000,2500,6),
     xlab = "Wavelength (nm)", main = "Average - Dark"); vps1 <- do.call(vpStack, baseViewports())

plot(mean(spec.l), lwd = 1.2, col = "red", ylab = "Absorbance", cex.lab = 1.5, cex.main = 1.5, xaxp=c(1000,2500,6),
     xlab = "Wavelength (nm)", main = "Average - Light")

plot(mean(spec.t), lwd = 1.2, col = "purple", ylab = "Absorbance", cex.lab = 1.5, cex.main = 1.5, xaxp=c(1000,2500,6),
     xlab = "Wavelength (nm)", main = "Average - Colourless")

plot(mean(spec.w), lwd = 1.2, col = "blue", ylab = "Absorbance", cex.lab = 1.5, cex.main = 1.5, xaxp=c(1000,2500,6),
     xlab = "Wavelength (nm)", main = "Average - White"); vps4 <- do.call(vpStack, baseViewports())

pushViewport(vps1)
X <- convertX(unit(1413,"native"), "npc")
X2 <- convertX(unit(1935,"native"), "npc")
X3 <- convertX(unit(2215,"native"), "npc")
X4 <- convertX(unit(2350,"native"), "npc")
#For some reason grid.text for peak labels does not always align with the x value for the dashed line, so need to add a specific value for the text
x1 <- convertX(unit(1436,"native"), "npc")
x2 <- convertX(unit(1936,"native"), "npc")
x3 <- convertX(unit(2212,"native"), "npc")
x4 <- convertX(unit(2335,"native"), "npc")
popViewport(3)


grid.move.to(x = X, y = unit(1, "npc"), vp = vps1)
grid.line.to(x = X, y = unit(0, "npc"), vp = vps4, 
             gp = gpar(col = "gray", lty = 2, lwd = 2))
grid.text("OH", x = x1, y = unit(0.87, "npc"), just="center", gp=gpar(font=2))

grid.move.to(x = X2, y = unit(1, "npc"), vp = vps1)
grid.line.to(x = X2, y = unit(0, "npc"), vp = vps4, 
             gp = gpar(col = "gray", lty = 2, lwd = 2))
grid.text("OH", x = x2, y = unit(0.93, "npc"), just="center", gp=gpar(font=2))

grid.move.to(x = X3, y = unit(1, "npc"), vp = vps1)
grid.line.to(x = X3, y = unit(0, "npc"), vp = vps4, 
             gp = gpar(col = "gray", lty = 2, lwd = 2))
grid.text("AlOH", x = x3, y = unit(0.95, "npc"), just="center", gp=gpar(font=2))

grid.move.to(x = X4, y = unit(1, "npc"), vp = vps1)
grid.line.to(x = X4, y = unit(0, "npc"), vp = vps4, 
             gp = gpar(col = "gray", lty = 2, lwd = 2))
grid.text("CO3", x = x4, y = unit(0.95, "npc"), just="center", gp=gpar(font=2))
```

 \linebreak

```{r nir-pca, fig.width=20, fig.height=8, fig.cap= "PCA score plot of 1st and 2nd components for the 1 000 nm – 2 500 nm region of the spectrum. Quartz-based material with a darker surface group to the right in the model, while those with white surface group in the bottom left quadrant. A trend of translucent material and opaque material with a beige tint grouping in the top left can also be seen. Three black samples at the top, from different sites, all feature no distinguishing peaks in their spectra thus separating them from the other samples in the dataset."}

#perform PCA with SNV normalization and mean-center
nir.pca <-
  prcomp(Points.nir[,c(680:2179)], center = TRUE, scale = FALSE)

#prepare a basic score plot with fviz_pca_ind using PC1 and PC2
basic_plot1 <-
  fviz_pca_ind(nir.pca, axes = c(1,2), label="none")

#prepare labels for PCs
nir.pc1var <- round(summary(nir.pca)$importance[2,1]*100, digits=1)
nir.pc2var <- round(summary(nir.pca)$importance[2,2]*100, digits=1)
nir.pc1lab <- paste0("PC1 (",as.character(nir.pc1var),"%)")
nir.pc2lab <- paste0("PC2 (",as.character(nir.pc2var),"%)")

#NIR LOADING LINES
#par(mfrow=c(3,1))
#sapply(1:3, function(comp){
#  plot(1001:2500, nir.pca$rotation[,comp], type='l', lwd=2,
#      main=paste("PC", comp), xlab="Wavelength (nm)", ylab="", cex.lab = 1.2, xaxp=c(1001,2500,6))}) 

#bind the basic fviz plot for PC 1 and 2, and use as basis for a more customizeable plot in ggpplot
ggplot(cbind(basic_plot1$data, Points.nir[, c(8,10)]),
             aes(x=x, y=y, 
                 shape = material, 
                 fill = munsell_hue)) +
  geom_point(size=3) +
  theme_bw() +
  ggtitle("Near infrared 1 000 - 2 500 nm") +
  labs(x = nir.pc1lab,
       y = nir.pc2lab) +
  scale_shape_manual(name = "Material",
                     values=pca.shapes) +
  scale_fill_manual(name = "Munsell hue",
                    breaks = c("Colourless", "2.5PB", "10B", "2.5GY", "5GY", "2.5Y", "5Y", "7.5Y", "10Y", "5YR", "N1", "N2", "N3", "N4", "N5", "N6", "N8", "N9"),
                    values=pca.colors) +
  guides(shape = guide_legend(override.aes = list(fill = "black"), 
                              ncol=2, 
                              title.position="top", 
                              title.hjust = 0.5),
         fill = guide_legend(override.aes = list(shape = 22,
                                                 fill = pca.colors,
                                                 color = "black",
                                                 size=3),
                             title.position="top", title.hjust = 0.5))+
  theme(plot.title = element_text(size = 12, face = "bold", colour = "black", vjust = - 10, hjust = 0.02),
        axis.title.x = element_text(size = 12, face = "bold", colour = "black"),
        axis.title.y = element_text(size = 12, face = "bold", colour = "black"),
        legend.title = element_text(size = 12, face = "bold", colour = "black"),
        legend.background = element_rect(linetype = "solid", color = "black"),
        legend.position = "bottom")
```

 \linebreak

## Raman
There are two distinctive features present in the Raman data (fig. \@ref(fig:raman-spectra)). The first are three peaks in the 100 cm^-1^ - 500 cm^-1^ band that are typical for SiO~2~ and quartz-based materials, with the strongest peak occuring at 460 cm^-1^ [@gillet_etal90]. These peaks are present for all samples in the dataset. The second feature shows up as two peaks occurring at around 1 287 cm^-1^ and 1 598 cm^-1^, and dominate the spectra in terms of intensity for the darker samples. These peak positions fall within what is referred to as the *D* and *G* band respectively, and have been observed in spectroscopic studies of graphite/graphene [@cesare_maineri99]. The D band occurs as a result of disordered carbon (C) structures whilst the G band is indicative of sp^2^ carbon networks and caused by stretching in the carbon bonds, which is common in graphite-based materials [@vollebregt_etal12; @lee_etal21]. Whereas the 2^nd^ peak falls within the typical position of the G band, the position of the D band is commonly identified as being in the 1 330 - 1 350 cm^-1^ region. It has, however, been documented that the dispersive behavior of the D band can cause a frequency change as a result of the energy of the incident laser [@pimenta_etal07 p.1280]. This could thus explain the discrepancy between the observed peak in the dataset and the literature.

A third feature, present in a small subset of the samples, appears as two peaks spaced closely together at ca. 695 cm^-1^ and 795 cm^-1^. Comparing these to reference samples from the mineral and rock collections kept at the Department of Ecology and Environmental Science at Umeå University, the same peaks are present in measurements collected on, among others, albite, apatite, diabase and shale. Studies of clay minerals [@kloprogge17] have identified a number of band regions in the lower wavenumbers related to Si, Al and OH vibrations, including the 700 - 800 cm^-1^ band which has been related to Al-O-Si vibrations for the Kaolin group. Considering the petrogenesis of quartzite and the likelihood that clay minerals are present in the material it is possible that this is what generates the feature in the current dataset.

The resulting PCA model (fig. \@ref(fig:raman-pca)) shows a clear trend along PC 1 (81.5 %) related to the quartz and D/G peaks. PC 2 and PC 3, however, mainly describes the remaining noise left in the spectra after detrending and preprocessing the data. Interestingly, the loading for PC 4 does catch the Al-O-Si peaks around the  700 cm^-1^ - 800 cm^-1^ band, which helps in separating out those samples where this feature is present. The measurements with mainly quartz peaks gravitates towards the negative side of the PC 1, and those where the graphite peaks are dominant towards the opposite side. It is also clear that the darker material feature more pronounced graphite peaks, whereas the lighter and more colourless objects mainly feature quartz peaks. As in the case of the NIR data, however, there are exceptions that break this trend, as well as a “muddled” middle group with both well-pronounced graphite and quartz peaks. When PC 4 is added the samples with quartz and Al-O-Si peaks gravitate towards the bottom left, separating themselves from the *quartz* group.

 \linebreak

```{r raman-spectra, fig.width=20, fig.height=15, fullwidth = TRUE, fig.cap="Mean spectrum of the raman data grouped by their hue. The *quartz peak* at 460 cm^-1^ is present in all four groups, but the *graphite peaks* at 1 287  cm^-1^ (D band) and 1 598 cm^-1^ (G band) mainly appear in the dark group"}

r.dark <- Points.raman %>% 
  filter(hue == "Dark")

spec.rd <- 
  as_spectra(r.dark, name_idx = 1, meta_idxs = 2:29)

r.light <- Points.raman %>% 
  filter(hue == "Light")

spec.rl <- 
  as_spectra(r.light, name_idx = 1, meta_idxs = 2:29)

r.colourless <- Points.raman %>% 
  filter(hue == "Colourless")

spec.rt <- 
  as_spectra(r.colourless, name_idx = 1, meta_idxs = 2:29)

r.white <- Points.raman %>% 
  filter(hue == "White")

spec.rw <- 
  as_spectra(r.white, name_idx = 1, meta_idxs = 2:29)

#Prepare a layout with 2 columns and 2 rows
par(mfrow=c(2,2))

#Plot the mean spectrum for each spectra group above with text annotations for the peaks in the first dark spectra
plot(mean(spec.rd), lwd = 1.2, col = "black", ylab = "Intensity", cex.lab = 1.5, cex.main = 1.5,
     xlab = "Wavenumber (cm^-1^)", main = "Average - Dark")
text(x=120, y=2900, labels="SiO", font=2, cex = 1.5)
text(x=200, y=4300, labels="SiO", font=2, cex = 1.5)
text(x=460, y=9250, labels="SiO", font=2, cex = 1.5)
text(x=1285, y=6300, labels="D", font=2, cex = 2.0)
text(x=1600, y=4000, labels="G", font=2, cex = 2.0)

plot(mean(spec.rl), lwd = 1.2, col = "red", ylab = "Intensity", cex.lab = 1.5, cex.main = 1.5,
     xlab = "Wavenumber (cm^-1^)", main = "Average - Light")

plot(mean(spec.rt), lwd = 1.2, col = "purple", ylab = "Intensity", cex.lab = 1.5, cex.main = 1.5,
     xlab = "Wavenumber (cm^-1^)", main = "Average - Colourless")

plot(mean(spec.rw), lwd = 1.2, col = "blue", ylab = "Intensity", cex.lab = 1.5, cex.main = 1.5,
     xlab = "Wavenumber (cm^-1^)", main = "Average - White")
```

 \linebreak

```{r raman-pca, fig.width=20, fig.height=15, fig.cap="PCA score plots for the raman spectra. The main explanatory power can be found in the 1^st^ component, which groups the data based on the quartz and D/G bands. As these are the main features in the data, the other components mainly describe the remaining noise, producing the arch-shape in the PCA. The 3^rd^ component does, however, also separate out the few samples that feature peaks at 700-800 cm^-1^ that may result from Al, Si and OH vibrations."}

#perform PCA with SNV normalization and mean-center
raman.pca <-
  prcomp(standardNormalVariate(X = Points.raman[,c(30:321)]), center = TRUE, scale = FALSE)

#prepare different basic score plots with fviz_pca_ind
basic_plot1 <-
  fviz_pca_ind(raman.pca, axes = c(1,2), label="none")

basic_plot2 <-
  fviz_pca_ind(raman.pca, axes = c(1,4), label="none")

#prepare labels for PCs
raman.pc1var <- round(summary(raman.pca)$importance[2,1]*100, digits=1)
raman.pc2var <- round(summary(raman.pca)$importance[2,2]*100, digits=1)
raman.pc4var <- round(summary(raman.pca)$importance[2,4]*100, digits=1)
raman.pc1lab <- paste0("PC1 (",as.character(raman.pc1var),"%)")
raman.pc2lab <- paste0("PC2 (",as.character(raman.pc2var),"%)")
raman.pc4lab <- paste0("PC4 (",as.character(raman.pc4var),"%)")

#RAMAN LOADING LINES
#par(mfrow=c(2,2))
#sapply(1:4, function(comp){
#  plot(row.names(raman.pca$rotation), raman.pca$rotation[,comp], type='l', lwd=2, 
#       main=paste("PC", comp), xlab="Wavelength (nm)", ylab="", cex.lab = 1.2, xaxp=c(92.88,1798.3,6))}) 


#bind the basic fviz plot for PC 1 and 2, and use as basis for a more customizeable plot in ggpplot
raman.p1 <- ggplot(cbind(basic_plot1$data, Points.raman[, c(8,10)]),
       aes(x=x, y=y, 
           shape = material, 
           fill = munsell_hue)) +
  geom_point(size=3) +
  theme_bw() +
  ggtitle("Raman") +
  labs(x = raman.pc1lab,
       y = raman.pc2lab) +
  scale_shape_manual(name = "Material",
                     values=pca.shapes) +
  scale_fill_manual(name = "Munsell hue",
                    breaks = c("Colourless", "2.5PB", "10B", "2.5GY", "5GY", "2.5Y", "5Y", "7.5Y", "10Y", "5YR", "N1", "N2", "N3", "N4", "N5", "N6", "N8", "N9"),
                    values=pca.colors) +
  guides(shape = guide_legend(override.aes = list(fill = "black"), 
                              ncol=2, 
                              title.position="top", 
                              title.hjust = 0.5),
         fill = guide_legend(override.aes = list(shape = 22,
                                                 fill = pca.colors,
                                                 color = "black",
                                                 size=3),
                             title.position="top", title.hjust = 0.5))+
  theme(legend.position = "none")

#bind the basic fviz plot for PC 1 and 3, and use as basis for a more customizeable plot in ggpplot
raman.p2 <- ggplot(cbind(basic_plot2$data, Points.raman[, c(8,10)]),
       aes(x=x, y=y, 
           shape = material, 
           fill = munsell_hue)) +
  geom_point(size=3) +
  theme_bw() +
  labs(x = raman.pc1lab,
       y = raman.pc4lab) +
  scale_shape_manual(name = "Material",
                     values=pca.shapes) +
  scale_fill_manual(name = "Munsell hue",
                    breaks = c("Colourless", "2.5PB", "10B", "2.5GY", "5GY", "2.5Y", "5Y", "7.5Y", "10Y", "5YR", "N1", "N2", "N3", "N4", "N5", "N6", "N8", "N9"),
                    values=pca.colors) +
  guides(shape = guide_legend(override.aes = list(fill = "black"), 
                              ncol=2, 
                              title.position="top", 
                              title.hjust = 0.5),
         fill = guide_legend(override.aes = list(shape = 22,
                                                 fill = pca.colors,
                                                 color = "black",
                                                 size=3),
                             title.position="top", title.hjust = 0.5))+
  theme(legend.position = "none")


comb <-
  raman.p1 + raman.p2 & theme(plot.title = element_text(size = 12, face = "bold", colour = "black"),
                              axis.title.x = element_text(size = 12, face = "bold", colour = "black"),
                              axis.title.y = element_text(size = 12, face = "bold", colour = "black"),
                              legend.title = element_text(size = 12, face = "bold", colour = "black"),
                              legend.background = element_rect(linetype = "solid", color = "black"),
                              legend.position = "bottom")

comb +
  plot_layout(nrow = 2, guides = "collect")
```

 \linebreak

## XRF
The XRF spectrometer is not capable of detecting all of the common elements, and the software therefore calculates a balance (Bal), which represents the remaining unquantifiable elements in a sample. The elements represented in this unquantifiable group are all those with an atomic number lower than ^12^Mg (REF). Univariate analysis shows that SiO^2^ makes up the main bulk of the composition of the material, and two major groups can be distinguished based on this content (fig. \@ref(fig:xrf-violin-plot)). The majority of the readings resulted in a SiO^2^ content of less than 50%, and about ¼ of the readings (~ 27%) featured a SiO^2^ content closer to 90 %. The “low” SiO^2^ group also feature a Bal between 40 – 70 %. 

The two first components of the PCA have an eigenvalue above 1 and the cumulative explained variance is ~ 81.3%. The loadings can be be seen in figure \@ref(fig:xrf-loadings). In the score plot of PC 1 and PC 2 two large clusters can be seen (fig. \@ref(fig:xrf-score-plot-p1-p2)). Interestingly, the smaller cluster on the left side in the model includes the samples with a SiO^2^ content higher than 50%, whilst the larger cluster includes those with lower SiO^2^ content. It does not seem to be ^14^Si that is responsible for this clustering, however, but rather ^26^Fe and ^40^Zr. The “low ^14^Si” cluster shows a trend along PC 2 of quartzite with a darker hue grouping towards the bottom. This may indicate a possible relation to the ^26^Fe content of the material as ^26^Fe-bearing minerals such as hematite can contribute to the dark colour in quartzite [@howard05 p.711]. The *brecciated quartz* samples largely group together at the top of the “low ^14^Si” cluster, with a couple ending up closer towards the “high ^14^Si” cluster. The white (N9) material is fairly evenly distributed within the right cluster. 

The group of measurements that are somewhat separated from the “low ^14^Si” cluster at the bottom are all but one from the rock painting site of *Finnforsberget*, which is located next to the Skellefte river. The *Finnforsberget* artefacts were sampled twice with object 491 having one measurement closer to the “low ^14^Si” group and the other the “high ^14^Si” group with ^13^Al estimated at 25 %. This artefact was sampled twice on each side, resulting in similar results both times.

One of the *colourless* samples also ends up in the "high ^14^Si" cluster among the darker material. Upon closer inspection this sample is small, ~ 3 by 1 mm, and also feature inclusions of dark particles. Both of these factors may have contributed to its placement in the model.

 \linebreak

```{r xrf-violin-plot, fig.width=15, fig.height=15, fig.fullwidth=TRUE, fig.cap="Violin plot of element content in quartzite samples measured using pXRF. **n** represents no. of measurements above Limit of Detection (LOD) for that element out of a total of 478 measurements. Note the bimodal distribution of Si measurements, these groups are reflected in the score plot of the PCA"}
#Prepare data in long format for violin plots
Points_long <-
  drop_na(Points.xrf %>%
    select(`12Mg`,`13Al`, `14Si`, `15P`, `16S`, `19K`, `20Ca`, `23V`, `25Mn`, `26Fe`, `30Zn`, `38Sr`, `39Y`, `40Zr`, `56Ba`, `81Ti`) %>%
    gather(key = "Element", value = "Value"))

# Add column with elemental groups for visualisation
Points_long <-
  Points_long %>%
    mutate(Group = case_when(
      endsWith(Element, "Mg") ~ "Alkaline Earth",
      endsWith(Element, "Al") ~ "Basic metal",
      endsWith(Element, "Si") ~ "Semimetal",
      endsWith(Element, "P") ~ "Nonmetal",
      endsWith(Element, "S") ~ "Nonmetal",
      endsWith(Element, "K") ~ "Alkali Metal",
      endsWith(Element, "Ca") ~ "Alkaline Earth",
      endsWith(Element, "V") ~ "Transition Metal",
      endsWith(Element, "Mn") ~ "Transition Metal",
      endsWith(Element, "Fe") ~ "Transition Metal",
      endsWith(Element, "Zn") ~ "Transition Metal",
      endsWith(Element, "Sr") ~ "Alkaline Earth",
      endsWith(Element, "Y") ~ "Transition Metal",
      endsWith(Element, "Zr") ~ "Transition Metal",
      endsWith(Element, "Ba") ~ "Alkaline Earth",
      endsWith(Element, "Ti") ~ "Transition Metal",
    ))

#Calculate and add value equal to 95% of the value range for each element, this is in preparation for 
#text annotations in final plot where a text will be positioned at this values height in each plot
Points_long <- 
  Points_long %>% 
  group_by(Element) %>% 
    mutate(ypos = min(Value)+0.95*diff(range(Value)))  

#Prepare colors
loading.colors <- c("darkorange", "darkolivegreen3", "skyblue1", "lightslateblue", "salmon1", "lightgoldenrod1")

#Lookup for element labeller
#Ändra ordning så att de mer avvikande (Si, Mn etc) hamnar uppe till vänster
Elements <- c(
  '12Mg' = "Mg",
  '13Al' = "Al",
  '14Si' = "Si",
  '15P' = "P",
  '16S'= "S",
  '19K' = "K",
  '20Ca' ="Ca",
  '23V' = "V",
  '25Mn' = "Mn",
  '26Fe' = "Fe",
  '30Zn' = "Zn",
  '38Sr' = "Sr",
  '39Y' = "Y",
  '40Zr' = "Zr",
  '56Ba' = "Ba",
  '81Ti' = "Ti"
  )

#Prepare data frame with elements for annotating facets in final plot
na_values <- 
  data.frame("Element" = unique(Points_long$Element))

#Calculate and add number of missing values for each element             
na_values <- 
  na_values %>% 
    mutate(na_values = c(
      paste("n = ", length(which(!is.na(Points.xrf$`12Mg`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`13Al`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`14Si`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`15P`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`16S`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`19K`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`20Ca`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`23V`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`25Mn`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`26Fe`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`30Zn`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`38Sr`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`39Y`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`40Zr`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`56Ba`)))),
      paste("n = ", length(which(!is.na(Points.xrf$`81Ti`)))))
    )

#Merge na_values and Points_long data frames in order to get the y position that the text annotation should be displayed
#in for each element facet in final plot
na_values <- 
  merge(na_values, unique(Points_long[,c("Element", "ypos")]), by = "Element", all.x = TRUE)

#Violin plot of elemental content, trimmed, with fill based on elemental groups and number of values under LOD as text annotation
Points_long %>%
    ggplot(aes(x=Element, y=Value, fill = Group)) +
    geom_violin(trim = TRUE) +
    facet_wrap( ~ Element, scales = "free", labeller = labeller(Element = Elements)) +
    scale_fill_manual(values=loading.colors) +
    theme_bw() +
    geom_text(data=na_values, aes(x=0.2, y=ypos, label=na_values, fontface = "bold"), nudge_x = 0.4, inherit.aes = FALSE) +
    theme(
      legend.title = element_text(size = 12, face = "bold", colour = "black"),
      strip.text.x = element_text(size = 12, face = "bold", colour = "black"),
      axis.title.x = element_blank(),
      plot.title = element_text(size=10, face = "bold", colour = "black", margin = margin(t = 10, b = -20), vjust=0.02, hjust=0.01),
      axis.title.y=element_blank(),
      axis.text.x=element_blank(),
      axis.ticks.x=element_blank())
```

 \linebreak

```{r xrf-loadings, fig.width=8, fig.height=8, fig.cap="Loading vectors (P1-P2) with scores for each loading (element)"}
#select elements to include in pca, as well as columns to group by
xrf <-
  Points.xrf %>%
    select(reading_no, sample_id, munsell_hue, material, `12Mg`, `13Al`, `14Si`, `15P`, `16S`, `19K`, `20Ca`, `23V`, `25Mn`, `26Fe`, `30Zn`, `38Sr`, `39Y`, `40Zr`, `56Ba`, `81Ti`)

#log transform data
xrf.log <- log(xrf[,5:20])

#impute missing values
xrf.imp <- imputePCA(xrf.log, ncp = 2, scale = FALSE, method = "Regularized", maxiter = 1000)

#perform pca with mean centering and unit variance scaling
xrf.pca <- prcomp(xrf.imp$completeObs, center = TRUE, scale.=TRUE)

#Extract loadings from xrf.pca
loadings <- as.data.frame(xrf.pca$rotation[,1:2])
#As elements are stored as rownames, set them as first column so it can be used as a variable
loadings <- setDT(loadings, keep.rownames = "Element")[]
#Melt loadings from wide to long format
loadings.melted <- melt(loadings, id.vars="Element")
#Set names of columns
loadings <- setNames(loadings.melted, c("Element", "PC", "Value"))

#bar graph of the loadings (P1-P2) for the XRF data
loadings %>%
  ggplot(aes(x=fct_rev(Element), y=Value)) +
  geom_bar(
    stat = "identity", position = "identity",
    color = "black", fill = "darkgrey",
    width = 0.5) +
  facet_wrap( ~ PC, scales = "free") +
  theme_bw() +
  theme(plot.margin = margin(10,10,10,10),
        axis.title.y = element_blank(),
        axis.text.y = element_text(size=10, face="bold", colour = "black"),
        axis.title.x = element_blank(),
        strip.text.x = element_text(size=14, face="bold", colour="black")) +
  coord_flip()
```

 \linebreak

```{r xrf-pca1, fig.width=15, fullwidth=TRUE, fig.height=10, fig.cap="XRF score plot of 1^st^ and 2nd components. The smaller group to the left in the plot includes samples with higher Si content, while the larger group includes samples with Si content < 50%."}

#XRF score plot
ggbiplot(xrf.pca,
         choices=c(1,2),
         obs.scale = 1,
         var.scale = 1,
         group=NULL,
         varname.size = 4,
         labels.size=3,
         ellipse = FALSE,
         circle = FALSE) +
theme_minimal() +
geom_point(aes(shape=Points.xrf$material, 
               fill = Points.xrf$munsell_hue), 
           size = 3) +
coord_cartesian() +
scale_shape_manual(name = "Material",
                   values=pca.shapes) +
scale_fill_manual(name = "Munsell hue",
                  breaks = pca.munsell_hue,
                  values=pca.colors) +
guides(shape = guide_legend(override.aes = list(fill = "black"),
                            ncol=2,
                            title.position="top",
                            title.hjust = 0.5),
       fill = guide_legend(override.aes = list(shape = 22,
                                               fill = pca.colors,
                                               color = "black",
                                               size=3),
                           title.position="top", title.hjust = 0.5)) +
theme(plot.title = element_text(size = 12, face = "bold", colour = "black"),
      axis.title.x = element_text(size = 12, face = "bold", colour = "black"),
      axis.title.y = element_text(size = 12, face = "bold", colour = "black"),
      legend.title = element_text(size = 12, face = "bold", colour = "black"),
      legend.background = element_rect(linetype = "solid", color = "black"),
      legend.position = "bottom")
```

 \linebreak
<!--
```{r xrf-pca2, fig.width=15, fullwidth=TRUE, fig.height=10, fig.cap="XRF score plot of 1^st^ and 3rd components. The same groupings of low/high Si content remains along PC1, but PC3 seems to separate darker and light samples further in the low Si group."}
ggbiplot(xrf.pca,
         choices=c(1,3),
         obs.scale = 1,
         var.scale = 1,
         group=NULL,
         varname.size = 4,
         labels.size=3,
         ellipse = FALSE,
         circle = FALSE) +
theme_minimal() +
geom_point(aes(shape=Points.xrf$material, 
               fill = Points.xrf$munsell_hue), 
           size = 3) +
coord_cartesian() +
scale_shape_manual(name = "Material",
                   values=pca.shapes) +
scale_fill_manual(name = "Munsell hue",
                  breaks = pca.munsell_hue,
                  values=pca.colors) +
guides(shape = guide_legend(override.aes = list(fill = "black"),
                            ncol=2,
                            title.position="top",
                            title.hjust = 0.5),
       fill = guide_legend(override.aes = list(shape = 22,
                                               fill = pca.colors,
                                               color = "black",
                                               title.position="top", 
                                               title.hjust = 0.5))) +
theme(plot.title = element_text(size = 12, face = "bold", colour = "black"),
      axis.title.x = element_text(size = 12, face = "bold", colour = "black"),
      axis.title.y = element_text(size = 12, face = "bold", colour = "black"),
      legend.title = element_text(size = 12, face = "bold", colour = "black"),
      legend.background = element_rect(linetype = "solid", color = "black"),
      legend.position = "bottom")
```
-->

# Discussion

 \linebreak
 \linebreak


The most easily recognizable megascopic feature of petrographic material is its colour, a feature that has been one of the main means of grouping quartzite in North Swedish archaeological research [e.g. @forsberg85 p.60-64; @kaeck09 p. 53-55]. While it is true that some inference can be made based on colour, such as ^26^Fe-bearing minerals contributing to a darker colour, this becomes increasingly difficult with heterogeneous material. Should a quartzite where the matrix is mainly light gray in colour, but streaked with black mineral veins, be considered a *light* or *dark* quartzite? The results above echoes this complexity. While the overall structure in the spectroscopic results for each of the instrumentations, and especially the NIRS, groups samples of similar colour (given as *Munsell hue*) together, there are samples that break these trends and thus demonstrate the presence of structural and compositional features that do not necessarily align with the perceived colour of a material. 

Rather than assigning color based on how it is perceived visually it can be approached in a more systematic manner [e.g. @fairchild13]. 

In the case of the Raman data the PCA is somewhat lacking in exploratory and descriptive power. Apart from the few samples that feature the 700 cm^-1^ - 800 cm^-1^ band peaks the major features in the data are all explained by the first component. As the intensity in Raman spectroscopy is not a direct quantitative indicator this makes it difficult to group materials based on the intensity of the D/G bands, making more of a binary separation of presence/absence of the *graphite peaks*. That is not to say that it is not possible to attempt quantification using Raman spectroscopy, but rather that this would necessitate a different experimental setup. That said, the presence of the *graphite peaks* may present an important clue in determining the potential geological origin for the material. Mentions of *graphitic quartzite* can be found in an early 20th century description of an excursion to Storfjället, Tärna parish, by the Geological Society [@motet25], but otherwise does not seem to be a frequently used term in the modern day. 

The Raman data is also a good example of the potential value of PCA components with a low degree of explained variance. While the typical statistical approach is to disregard components with an eigenvalue below 1, in the case of spectral data there may still be meaningful features explained by those very same components. The eigenvalue of the 4^th^ component in the Raman PCA is below 1, but amidst the noise there were still meaningful features that may be used for characterization.

Interestingly the *brecciated quartz* remains relatively grouped together in all of the models demonstrating some consistency with the original classification. As the material does group with other similarly semi-translucent material it does not seem to distinguish itself enough in the models in order to consider it its own group. The original classification by @ahman67 refers to the microscopic fragmented configuration of the quartz crystals as being the main distinguishing feature, and while it is possible to discern the presence of SiO structure through non-destructive spectroscopy, there have been no other discernible features related to this group at this stage. The question remains whether the material classified as *brecciated quartzite*


 \linebreak

# Conclusion

The results demonstrate clearly that all three instrumentations are capable of characterizing some aspect of the quartz and quartzite, however, taken on their own they lack the resolution needed to provide a detailed enough fingerprint based solely on surface measurements. Nevertheless they do provide a more in-depth understanding of the composition and structure of the material as well as the complexity which exists in quartz and quartzite materials. The study represents a good example of an exploratory approach in the characterization of petrographic material, where there is an absence of reference material. With a large enough dataset exploratory multivariate statistics can be used in order to discern groupings based on the spectral features, taking advantage of the short integration 

and combining these results may be the key to more robust non-destructive characterization of petrographic material. 



 \linebreak
 \linebreak

# Acknowledgements

I would like to thank my supervisors, Philip I. Buckland and Johan Linderholm, for valuable comments on previous versions of this paper. 

 \linebreak
 \linebreak

<!-- The following line inserts a page break  -->

\newpage

# References 

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

<div id="refs"></div>

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
